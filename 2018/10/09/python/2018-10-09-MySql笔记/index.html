<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>MySql笔记 | Anrue Blod</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="iOS, Pyton, Anrue, Anrue blog, iOS博客, 程序员"><meta name="description" content="这般花花草草由人恋，酸酸楚楚随人愿，便生生死死无人怨！"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://github.com/anru1314/2018/10/09/python/2018-10-09-MySql笔记/index.html"><link rel="icon" type="image/png" href="/img/favicon.png" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Anrue"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129291851-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-129291851-1")</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart=""><div id="page-loading" class="page page-loading" style="background-image:url(http://oo12ugek5.bkt.clouddn.com/blog/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Anrue" alt="Anrue"><img src="/img/logo.png" alt="Anrue"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="HOME" title="HOME">HOME</a></li><li class="nav__item"><a href="/categories/iOS" alt="iOS" title="iOS">iOS</a></li><li class="nav__item"><a href="/categories/Python" alt="Python" title="Python">Python</a></li><li class="nav__item"><a href="/GirlsPhotos" alt="小姐姐" title="小姐姐">小姐姐</a></li><li class="nav__item"><a href="/archives" alt="时间轴" title="时间轴">时间轴</a></li><li class="nav__item"><a href="/about" alt="ABOUT" title="ABOUT">ABOUT</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/images/python/2018-10-10-常见图片格式/topImg.png" alt="MySql笔记"></div><header class="post__info"><h1 class="post__title">MySql笔记</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://www.github.com/anru1314">Anrue</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-10-09</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/MySql/">MySql</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><a id="more"></a><h2 id="使用命令开启、连接"><a href="#使用命令开启、连接" class="headerlink" title="使用命令开启、连接"></a>使用命令开启、连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql.server start/stop</span><br><span class="line">开启服务</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line">回车后输入密码，当前设置的密码为mysql</span><br><span class="line"></span><br><span class="line">\q 退出 \c 清空 （语句后面加分号;）</span><br></pre></td></tr></table></figure><h3 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h3><ul><li>一般在公司开发中，可能会将数据库统一搭建在一台服务器上，所有开发人员共用一个数据库，而不是在自己的电脑中配置一个数据库</li><li>运行命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hip地址 -uroot -p</span><br></pre></td></tr></table></figure><ul><li>-h后面写要连接的主机ip地址</li><li>-u后面写连接的用户名</li><li>-p回车后写密码</li></ul><h2 id="数据库、表、数据操作"><a href="#数据库、表、数据操作" class="headerlink" title="数据库、表、数据操作"></a>数据库、表、数据操作</h2><hr><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><ul><li>查看所有数据库</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure><ul><li>创建数据库</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名 charset=utf8;</span><br></pre></td></tr></table></figure><ul><li>删除数据库</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名;</span><br></pre></td></tr></table></figure><ul><li>切换数据库</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure><ul><li>查看当前选择的数据库</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select database();</span><br></pre></td></tr></table></figure><hr><h3 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h3><ul><li>查看当前数据库中所有表</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure><ul><li>创建表</li><li>auto_increment表示自动增长</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(列及类型);</span><br><span class="line">如：</span><br><span class="line">create table students(</span><br><span class="line">id int auto_increment primary key,</span><br><span class="line">sname varchar(10) not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>修改表</li></ul><p>alter 是修改表结构，如对字段增加、删除、修改类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add|change|drop 列名 类型;</span><br><span class="line">如：</span><br><span class="line">alter table students add birthday datetime;</span><br></pre></td></tr></table></figure><ul><li>删除表</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table 表名;</span><br></pre></td></tr></table></figure><ul><li>查看表结构</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc 表名;</span><br></pre></td></tr></table></figure><ul><li>更改表名称</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table 原表名 to 新表名;</span><br></pre></td></tr></table></figure><ul><li>查看表的创建语句</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table &apos;表名&apos;;</span><br></pre></td></tr></table></figure><hr><h3 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h3><ul><li>查询</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名</span><br></pre></td></tr></table></figure><ul><li>增加</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">全列插入：insert into 表名 values(...);</span><br><span class="line">缺省插入：insert into 表名(列1,...) values(值1,...);</span><br><span class="line">同时插入多条数据：insert into 表名 values(...),(...)...;</span><br><span class="line">或insert into 表名(列1,...) values(值1,...),(值1,...)...;</span><br><span class="line">主键列是自动增长，但是在全列插入时需要占位，通常使用0，插入成功后以实际数据为准</span><br></pre></td></tr></table></figure><ul><li>修改</li></ul><p>update用来修改表中的数据，修改某一行某一列的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update 表名 set 列1=值1,... where 条件</span><br></pre></td></tr></table></figure><ul><li>删除</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from 表名 where 条件</span><br></pre></td></tr></table></figure><ul><li>逻辑删除，本质就是修改操作update</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table students add isdelete bit default 0;</span><br><span class="line">如果需要删除则</span><br><span class="line">update students isdelete=1 where ...;</span><br></pre></td></tr></table></figure><hr><h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><h4 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h4><ul><li>运行mysqldump命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump –uroot –p 数据库名 &gt; ~/Desktop/备份文件.sql;</span><br><span class="line">按提示输入mysql的密码</span><br></pre></td></tr></table></figure><h4 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h4><p>其实就是创建表，插入表的一个过程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">连接mysql，创建数据库</span><br><span class="line"></span><br><span class="line">退出连接，执行如下命令</span><br><span class="line"></span><br><span class="line">mysql -u root –p 数据库名 &lt; ~/Desktop/备份文件.sql</span><br><span class="line">根据提示输入mysql密码</span><br></pre></td></tr></table></figure><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li>查询的基本语法</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名;</span><br></pre></td></tr></table></figure><ul><li>from关键字后面写表名，表示数据来源于是这张表</li><li>select后面写表中的列名，如果是*表示在结果中显示表中所有列</li><li>在select后面的列名部分，可以使用as为列起别名，这个别名出现在结果集中</li><li><p>如果要查询多个列，之间使用逗号分隔</p></li><li><p>消除重复行<br>在select后面列前使用distinct可以消除重复的行</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct gender from students;</span><br></pre></td></tr></table></figure><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><p>使用where子句对表中的数据筛选，结果为true的行会出现在结果集中<br>语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名 where 条件;</span><br></pre></td></tr></table></figure><h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">等于=</span><br><span class="line">大于&gt;</span><br><span class="line">大于等于&gt;=</span><br><span class="line">小于&lt;</span><br><span class="line">小于等于&lt;=</span><br><span class="line">不等于!=或&lt;&gt;</span><br></pre></td></tr></table></figure><ul><li>查询编号大于3的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id&gt;3;</span><br></pre></td></tr></table></figure><ul><li>查询编号不大于4的科目</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from subjects where id&lt;=4;</span><br></pre></td></tr></table></figure><ul><li>查询姓名不是“黄蓉”的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where sname!=&apos;黄蓉&apos;;</span><br></pre></td></tr></table></figure><ul><li>查询没被删除的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where isdelete=0;</span><br></pre></td></tr></table></figure><h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and</span><br><span class="line">or</span><br><span class="line">not</span><br></pre></td></tr></table></figure><ul><li>查询编号大于3的女同学</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id&gt;3 and gender=0;</span><br></pre></td></tr></table></figure><ul><li>查询编号小于4或没被删除的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id&lt;4 or isdelete=0;</span><br></pre></td></tr></table></figure><ul><li>模糊查询<br><strong>like</strong></li><li>%表示任意多个任意字符</li><li>_表示一个任意字符</li><li>查询姓黄的学生</li></ul><figure class="highlight plain"><figcaption><span>* from students where sname like '黄%';</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">* 查询姓黄并且名字是一个字的学生</span><br></pre></td></tr></table></figure><p>select * from students where sname like ‘黄_’;<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 查询姓黄或叫靖的学生</span><br><span class="line"></span><br><span class="line">```select * from students where sname like &apos;黄%&apos; or sname like &apos;%靖%&apos;;</span><br></pre></td></tr></table></figure><p></p><h4 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h4><ul><li>in表示在一个非连续的范围内</li><li>查询编号是1或3或8的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id in(1,3,8);</span><br></pre></td></tr></table></figure><ul><li><p><strong>between … and …表示在一个连续的范围内</strong></p></li><li><p>查询学生是3至8的学生</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id between 3 and 8;</span><br></pre></td></tr></table></figure><ul><li>查询学生是3至8的男生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where id between 3 and 8 and gender=1;</span><br></pre></td></tr></table></figure><h4 id="空判断"><a href="#空判断" class="headerlink" title="空判断"></a>空判断</h4><p><strong>注意：null与’’是不同的</strong><br><strong>判空is null</strong></p><ul><li>查询没有填写地址的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where hometown is null;</span><br></pre></td></tr></table></figure><p><strong>判非空is not null</strong></p><ul><li>查询填写了地址的学生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where hometown is not null;</span><br></pre></td></tr></table></figure><ul><li>查询填写了地址的女生</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from students where hometown is not null and gender=0;</span><br></pre></td></tr></table></figure><h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><p>小括号，not，比较运算符，逻辑运算符<br>and比or先运算，如果同时出现并希望先算or，需要结合()使用</p><h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p><strong>为了快速得到统计数据，提供了5个聚合函数</strong></p><ul><li>count(*)表示计算总行数，括号中写星与列名，结果是相同的</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询学生总数</span><br><span class="line">select count(*) from students;</span><br></pre></td></tr></table></figure><ul><li>max(列)表示求此列的最大值</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询女生的编号最大值</span><br><span class="line">select max(id) from students where gender=0;</span><br></pre></td></tr></table></figure><ul><li>min(列)表示求此列的最小值</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询未删除的学生最小编号</span><br><span class="line">select min(id) from students where isdelete=0;</span><br></pre></td></tr></table></figure><ul><li>sum(列)表示求此列的和</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询男生的编号之后</span><br><span class="line">select sum(id) from students where gender=1;</span><br></pre></td></tr></table></figure><ul><li>avg(列)表示求此列的平均值</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询未删除女生的编号平均值</span><br><span class="line">select avg(id) from students where isdelete=0 and gender=0;</span><br></pre></td></tr></table></figure><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><blockquote><p>按照字段分组，表示此字段相同的数据会被放到一个组中<br>分组后，只能查询出相同的数据列，对于有差异的数据列无法出现在结果集中<br>可以对分组后的数据进行统计，做聚合运算</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">select 列1,列2,聚合... from 表名 group by 列1,列2,列3...</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询男女生总数</span><br><span class="line">select gender as 性别,count(*)</span><br><span class="line">from students</span><br><span class="line">group by gender;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询各城市人数</span><br><span class="line">select hometown as 家乡,count(*)</span><br><span class="line">from students</span><br><span class="line">group by hometown;</span><br></pre></td></tr></table></figure><blockquote><p>分组后的数据筛选</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">select 列1,列2,聚合... from 表名</span><br><span class="line">group by 列1,列2,列3...</span><br><span class="line">having 列1,...聚合...</span><br><span class="line">having后面的条件运算符与where的相同</span><br></pre></td></tr></table></figure><ul><li>查询男生总人数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">方案一</span><br><span class="line">select count(*)</span><br><span class="line">from students</span><br><span class="line">where gender=1;</span><br><span class="line"></span><br><span class="line">方案二：</span><br><span class="line">select gender as 性别,count(*)</span><br><span class="line">from students</span><br><span class="line">group by gender</span><br><span class="line">having gender=1;</span><br><span class="line">对比where与having</span><br></pre></td></tr></table></figure><p><strong>where是对from后面指定的表进行数据筛选，属于对原始数据的筛选<br>having是对group by的结果进行筛选</strong></p><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><ul><li>为了方便查看数据，可以对数据进行排序</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">select * from 表名</span><br><span class="line">order by 列1 asc|desc,列2 asc|desc,...</span><br></pre></td></tr></table></figure><blockquote><p>将行数据按照列1进行排序，如果某些行列1的值相同时，则按照列2排序，以此类推<br>默认按照列值从小到大排列<br><strong>asc从小到大排列，即升序</strong><br><strong>desc从大到小排序，即降序</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询未删除男生学生信息，按学号降序</span><br><span class="line">select * from students</span><br><span class="line">where gender=1 and isdelete=0</span><br><span class="line">order by id desc;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询未删除科目信息，按名称升序</span><br><span class="line">select * from subject</span><br><span class="line">where isdelete=0</span><br><span class="line">order by stitle;</span><br></pre></td></tr></table></figure><hr><h3 id="获取部分行-分页"><a href="#获取部分行-分页" class="headerlink" title="获取部分行(分页)"></a>获取部分行(分页)</h3><ul><li>当数据量过大时，在一页中查看数据是一件非常麻烦的事情</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">select * from 表名</span><br><span class="line">limit start,count</span><br><span class="line">从start开始，获取count条数据</span><br><span class="line">start索引从0开始</span><br></pre></td></tr></table></figure><p>示例：分页</p><ul><li>已知：每页显示m条数据，当前显示第n页</li><li>求总页数：此段逻辑后面会在python中实现<ul><li>查询总条数p1</li><li>使用p1除以m得到p2</li><li>如果整除则p2为总数页</li><li>如果不整除则p2+1为总页数</li></ul></li><li>求第n页的数据</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from students</span><br><span class="line">where isdelete=0</span><br><span class="line">limit (n-1)*m,m</span><br></pre></td></tr></table></figure><ul><li>完整的select语句</li></ul><figure class="highlight plain"><figcaption><span>distinct *</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from 表名</span><br><span class="line">where ....</span><br><span class="line">group by ... having ...</span><br><span class="line">order by ...</span><br><span class="line">limit star,count</span><br></pre></td></tr></table></figure><ul><li>执行顺序为：</li></ul><figure class="highlight plain"><figcaption><span>表名</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">where ....</span><br><span class="line">group by ...</span><br><span class="line">select distinct *</span><br><span class="line">having ...</span><br><span class="line">order by ...</span><br><span class="line">limit star,count</span><br></pre></td></tr></table></figure><p>ps ：实际使用中，只是语句中某些部分的组合，而不是全部</p><hr><h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><ul><li>实体与实体之间有3种对应关系，这些关系也需要存储下来</li><li>在开发中需要对存储的数据进行一些处理，用到内置的一些函数</li><li>视图用于完成查询语句的封装</li><li>事务可以保证复杂的增删改操作有效</li></ul><h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><ul><li>创建成绩表scores，结构如下<ul><li>id</li><li>学生</li><li>科目</li><li>成绩</li></ul></li><li>思考：学生列应该存什么信息呢？</li><li><p>答：学生列的数据不是在这里新建的，而应该从学生表引用过来，关系也是一条数据；根据范式要求应该存储学生的编号，而不是学生的姓名等其它信息<br>同理，科目表也是关系列，引用科目表中的数据<br>关系</p></li><li><p>创建表的语句如下</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table scores(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">stuid int,</span><br><span class="line">subid int,</span><br><span class="line">score decimal(5,2)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h5 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h5><ul><li>思考：怎么保证关系列数据的有效性呢？任何整数都可以吗？</li><li>答：必须是学生表中id列存在的数据，可以通过外键约束进行数据的有效性验证</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">为stuid添加外键约束</span><br><span class="line">alter table scores add constraint stu_sco foreign key(stuid) references students(id);</span><br></pre></td></tr></table></figure><ul><li>此时插入或者修改数据时，如果stuid的值在students表中不存在则会报错</li><li>在创建表时可以直接创建约束</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table scores(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">stuid int,</span><br><span class="line">subid int,</span><br><span class="line">score decimal(5,2),</span><br><span class="line">foreign key(stuid) references students(id),</span><br><span class="line">foreign key(subid) references subjects(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h6 id="外键的级联操作"><a href="#外键的级联操作" class="headerlink" title="外键的级联操作"></a>外键的级联操作</h6><ul><li>在删除students表的数据时，如果这个id值在scores中已经存在，则会抛异常</li><li>推荐使用逻辑删除，还可以解决这个问题</li><li>可以创建表时指定级联操作，也可以在创建表后再修改外键的级联操作</li></ul><p>语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table scores add constraint stu_sco foreign key(stuid) references students(id) on delete cascade;</span><br></pre></td></tr></table></figure><ul><li>级联操作的类型包括：<ul><li>restrict（限制）：默认值，抛异常</li><li>cascade（级联）：如果主表的记录删掉，则从表中相关联的记录都将被删除</li><li>set null：将外键设置为空</li><li>no action：什么都不做</li></ul></li></ul><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><h4 id="先看个问题"><a href="#先看个问题" class="headerlink" title="先看个问题"></a>先看个问题</h4><ul><li>问：查询每个学生每个科目的分数<blockquote><p>分析：学生姓名来源于students表，科目名称来源于subjects，分数来源于scores表，怎么将3个表放到一起查询，并将结果显示在同一个结果集中呢？<br>答：当查询结果来源于多张表时，需要使用连接查询</p></blockquote></li><li>关键：找到表间的关系，当前的关系是<ul><li>students表的id—scores表的stuid</li><li>subjects表的id—scores表的subid</li></ul></li><li>则上面问题的答案是：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,subjects.stitle,scores.score</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">inner join subjects on scores.subid=subjects.id;</span><br></pre></td></tr></table></figure><ul><li>结论：当需要对有关系的多张表进行查询时，需要使用连接join</li></ul><h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><ul><li>连接查询分类如下：<ul><li>表A inner join 表B：表A与表B匹配的行会出现在结果中</li><li>表A left join 表B：表A与表B匹配的行会出现在结果中，外加表A中独有的数据，未对应的数据使用null填充</li><li>表A right join 表B：表A与表B匹配的行会出现在结果中，外加表B中独有的数据，未对应的数据使用null填充</li></ul></li><li>在查询或条件中推荐使用“表名.列名”的语法</li><li>如果多个表中列名不重复可以省略“表名.”部分</li><li>如果表的名称太长，可以在表名后面使用’ as 简写名’或’ 简写名’，为表起个临时的简写名称</li></ul><h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p>查询学生的姓名、平均分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">group by students.sname;</span><br></pre></td></tr></table></figure><p>查询男生的姓名、总分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select students.sname,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join students on scores.stuid=students.id</span><br><span class="line">where students.gender=1</span><br><span class="line">group by students.sname;</span><br></pre></td></tr></table></figure><p>查询科目的名称、平均分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select subjects.stitle,avg(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join subjects on scores.subid=subjects.id</span><br><span class="line">group by subjects.stitle;</span><br></pre></td></tr></table></figure><p>查询未删除科目的名称、最高分、平均分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select subjects.stitle,avg(scores.score),max(scores.score)</span><br><span class="line">from scores</span><br><span class="line">inner join subjects on scores.subid=subjects.id</span><br><span class="line">where subjects.isdelete=0</span><br><span class="line">group by subjects.stitle;</span><br></pre></td></tr></table></figure><h3 id="自关联"><a href="#自关联" class="headerlink" title="自关联"></a>自关联</h3><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><ul><li>查询支持嵌套使用</li><li>查询各学生的语文、数学、英语的成绩</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select sname,</span><br><span class="line">(select sco.score from scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;语文&apos; and stuid=stu.id) as 语文,</span><br><span class="line">(select sco.score from  scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;数学&apos; and stuid=stu.id) as 数学,</span><br><span class="line">(select sco.score from  scores sco inner join subjects sub on sco.subid=sub.id where sub.stitle=&apos;英语&apos; and stuid=stu.id) as 英语</span><br><span class="line">from students stu;</span><br></pre></td></tr></table></figure><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><ul><li>对于复杂的查询，在多次使用后，维护是一件非常麻烦的事情</li><li><p>解决：定义视图<br>视图本质就是对查询的一个封装</p></li><li><p>定义视图</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create view stuscore as </span><br><span class="line">select students.*,scores.score from scores</span><br><span class="line">inner join students on scores.stuid=students.id;</span><br></pre></td></tr></table></figure><ul><li>视图的用途就是查询</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from stuscore;</span><br></pre></td></tr></table></figure><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><ul><li>当一个业务逻辑需要多个sql完成时，如果其中某条sql语句出错，则希望整个操作都退回</li><li>使用事务可以完成退回的功能，保证业务逻辑的正确性</li><li>事务四大特性(简称ACID)<ul><li>原子性(Atomicity)：事务中的全部操作在数据库中是不可分割的，要么全部完成，要么均不执行</li><li>一致性(Consistency)：几个并行执行的事务，其执行结果必须与按某一顺序串行执行的结果相一致</li><li>隔离性(Isolation)：事务的执行不受其他事务的干扰，事务执行的中间结果对其他事务必须是透明的</li><li>持久性(Durability)：对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障</li></ul></li><li>要求：表的类型必须是innodb或bdb类型，才可以对此表使用事务</li></ul><p>查看表的创建语句</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table students;</span><br></pre></td></tr></table></figure><p>修改表的类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &apos;表名&apos; engine=innodb;</span><br></pre></td></tr></table></figure><ul><li>事务语句<ul><li>开启begin;</li><li>提交commit;</li><li>回滚rollback;</li></ul></li></ul><p>示例1</p><ul><li>步骤1：打开两个终端，连接mysql，使用同一个数据库，操作同一张表</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">------------------------</span><br><span class="line">终端2：</span><br><span class="line">begin;</span><br><span class="line">insert into students(sname) values(&apos;张飞&apos;);</span><br><span class="line">步骤2</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">步骤3</span><br><span class="line">终端2：</span><br><span class="line">commit;</span><br><span class="line">------------------------</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure><ul><li>示例2</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">步骤1：打开两个终端，连接mysql，使用同一个数据库，操作同一张表</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">------------------------</span><br><span class="line">终端2：</span><br><span class="line">begin;</span><br><span class="line">insert into students(sname) values(&apos;张飞&apos;);</span><br><span class="line">步骤2</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br><span class="line">步骤3</span><br><span class="line">终端2：</span><br><span class="line">rollback;</span><br><span class="line">------------------------</span><br><span class="line">终端1：</span><br><span class="line">select * from students;</span><br></pre></td></tr></table></figure><h2 id="于python交互"><a href="#于python交互" class="headerlink" title="于python交互"></a>于python交互</h2><h3 id="交互类型"><a href="#交互类型" class="headerlink" title="交互类型"></a>交互类型</h3><ul><li>在文件中引入模块</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Mysqldb</span><br></pre></td></tr></table></figure><h5 id="Connection对象"><a href="#Connection对象" class="headerlink" title="Connection对象"></a>Connection对象</h5><p>用于建立与数据库的连接</p><ul><li>创建对象：调用connect()方法<br><code>conn=connect(参数列表)</code><ul><li>参数host：连接的mysql主机，如果本机是’localhost’</li><li>参数port：连接的mysql主机的端口，默认是3306</li><li>参数db：数据库的名称</li><li>参数user：连接的用户名</li><li>参数password：连接的密码</li><li>参数charset：通信采用的编码方式，默认是’gb2312’，要求与数据库创建时指定的编码一致，否则中文会乱码</li></ul></li><li>对象的方法<ul><li>close()关闭连接</li><li>commit()事务，所以需要提交才会生效</li><li>rollback()事务，放弃之前的操作</li><li>cursor()返回Cursor对象，用于执行sql语句并获得结果<h5 id="Cursor对象"><a href="#Cursor对象" class="headerlink" title="Cursor对象"></a>Cursor对象</h5>执行sql语句</li></ul></li><li>创建对象：调用Connection对象的cursor()方法</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor1=conn.cursor()</span><br></pre></td></tr></table></figure><ul><li>对象的方法<ul><li>close()关闭</li><li>execute(operation [, parameters ])执行语句，返回受影响的行数</li><li>fetchone()执行查询语句时，获取查询结果集的第一个行数据，返回一个元组</li><li>next()执行查询语句时，获取当前行的下一行</li><li>fetchall()执行查询时，获取结果集的所有行，一行构成一个元组，再将这些元组装入一个元组返回</li><li>scroll(value[,mode])将行指针移动到某个位置</li><li>mode表示移动的方式</li><li>mode的默认值为relative，表示基于当前行移动到value，value为正则向下移动，value为负则向上移动</li><li>mode的值为absolute，表示基于第一条数据的位置，第一条数据的位置为0</li><li>对象的属性</li><li>rowcount只读属性，表示最近一次execute()执行后受影响的行数</li><li>connection获得当前连接对象<h5 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h5>创建testInsert.py文件，向学生表中插入一条数据</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;insert into students(sname) values(&apos;张良&apos;)&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure><h5 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h5><p>创建testUpdate.py文件，修改学生表的一条数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;update students set sname=&apos;刘邦&apos; where id=6&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure><h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p>创建testDelete.py文件，删除学生表的一条数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    count=cs1.execute(&quot;delete from students where id=6&quot;)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br><span class="line">SQL语句参数化</span><br><span class="line">创建testInsertParam.py文件，向学生表中插入一条数据</span><br><span class="line">#encoding=utf-8</span><br><span class="line">import MySQLdb</span><br><span class="line">try:</span><br><span class="line">    conn=MySQLdb.connect(host=&apos;localhost&apos;,port=3306,db=&apos;test1&apos;,user=&apos;root&apos;,passwd=&apos;mysql&apos;,charset=&apos;utf8&apos;)</span><br><span class="line">    cs1=conn.cursor()</span><br><span class="line">    sname=raw_input(&quot;请输入学生姓名：&quot;)</span><br><span class="line">    params=[sname]</span><br><span class="line">    count=cs1.execute(&apos;insert into students(sname) values(%s)&apos;,params)</span><br><span class="line">    print count</span><br><span class="line">    conn.commit()</span><br><span class="line">    cs1.close()</span><br><span class="line">    conn.close()</span><br><span class="line">except Exception,e:</span><br><span class="line">    print e.message</span><br></pre></td></tr></table></figure><h5 id="其它语句"><a href="#其它语句" class="headerlink" title="其它语句"></a>其它语句</h5><p>cursor对象的execute（）方法，也可以用于执行create table等语句<br>建议在开发之初，就创建好数据库表结构，不要在这里执行</p><h5 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MySqlhelper:</span><br><span class="line"></span><br><span class="line">    def __init__(self, host, db, user, pwd, port=3306, charset=&quot;utf8&quot;):</span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.db = db</span><br><span class="line">        self.user = user</span><br><span class="line">        self.passwd = pwd</span><br><span class="line">        self.charset = charset</span><br><span class="line"></span><br><span class="line">    def connect(self):</span><br><span class="line">        self.conn = pymysql.connect(</span><br><span class="line">            host=self.host,</span><br><span class="line">            port=self.port,</span><br><span class="line">            db=self.db,</span><br><span class="line">            user=self.user,</span><br><span class="line">            passwd=self.passwd,</span><br><span class="line">            charset=self.charset</span><br><span class="line">        )</span><br><span class="line">        self.cursor = self.conn.cursor()</span><br><span class="line"></span><br><span class="line">    def close(self):</span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line">    # private api</span><br><span class="line">    def __edit(self, sql, param):</span><br><span class="line">        count = 0</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql, param)</span><br><span class="line">            self.conn.commit()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception as result:</span><br><span class="line">            print(result)</span><br><span class="line">        else:</span><br><span class="line">            return count</span><br><span class="line"></span><br><span class="line">    # 插入</span><br><span class="line">    def insert(self, sql, params=()):</span><br><span class="line">        return self.__edit(sql, params)</span><br><span class="line"></span><br><span class="line">    # 更改</span><br><span class="line">    def update(self, sql, params=()):</span><br><span class="line">        return self.__edit(sql, params)</span><br><span class="line"></span><br><span class="line">    # 删除</span><br><span class="line">    def delete(self, sql, params=()):</span><br><span class="line">        return self.__edit(sql, params)</span><br><span class="line"></span><br><span class="line">    def get_one(self, sql):</span><br><span class="line">        result = None</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql)</span><br><span class="line">            result = self.cursor.fetchone()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(e)</span><br><span class="line">        else:</span><br><span class="line">            return result</span><br><span class="line"></span><br><span class="line">    def get_all(self, sql):</span><br><span class="line">        result = []</span><br><span class="line">        try:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql)</span><br><span class="line">            result = self.cursor.fetchall()</span><br><span class="line">            self.close()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(e)</span><br><span class="line">        else:</span><br><span class="line">            return result</span><br></pre></td></tr></table></figure><div class="post-announce">感谢您的阅读，本文由 <a href="https://github.com/anru1314">Anrue</a> 版权所有。如若转载，请注明出处：Anrue（<a href="https://github.com/anru1314/2018/10/09/python/2018-10-09-MySql笔记/">https://github.com/anru1314/2018/10/09/python/2018-10-09-MySql笔记/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/10/09/iOS/2018-10-09-自定义转场动画/" title="自定义转场动画"><i class="iconfont icon-prev"></i>自定义转场动画</a></div><div class="post__prev post__prev--right"><a href="/2018/10/10/python/2018-10-10-常见图片格式/" title="常见图片格式">常见图片格式<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">这般花花草草由人恋，酸酸楚楚随人愿，便生生死死无人怨！</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/iOS/">iOS</a><span class="block-list-count">4</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Python/">Python</a><span class="block-list-count">2</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2018/11/09/iOS/2018-11-09-iOS-中的各种锁/" title="不可描述的 iOS 锁事"><div class="item__cover"><img src="/images/iOS/2018-11-09-iOS-中的各种锁/topImg.png" alt="不可描述的 iOS 锁事"></div><div class="item__info"><h3 class="item__title">不可描述的 iOS 锁事</h3><span class="item__text">2018-11-09</span></div></a></li><li class="latest-post-item"><a href="/2018/10/31/iOS/2018-10-31-组件化中遇到的问题-篇章一/" title="组件化中遇到的问题--篇章一"><div class="item__cover"><img src="/images/iOS/2018-10-31-组件化中遇到的问题-篇章一/topImg.png" alt="组件化中遇到的问题--篇章一"></div><div class="item__info"><h3 class="item__title">组件化中遇到的问题--篇章一</h3><span class="item__text">2018-10-31</span></div></a></li><li class="latest-post-item"><a href="/2018/10/10/python/2018-10-10-常见图片格式/" title="常见图片格式"><div class="item__cover"><img src="/images/python/常用图片格式详解.png" alt="常见图片格式"></div><div class="item__info"><h3 class="item__title">常见图片格式</h3><span class="item__text">2018-10-10</span></div></a></li><li class="latest-post-item"><a href="/2018/10/09/python/2018-10-09-MySql笔记/" title="MySql笔记"><div class="item__cover"><img src="/images/python/2018-10-10-常见图片格式/topImg.png" alt="MySql笔记"></div><div class="item__info"><h3 class="item__title">MySql笔记</h3><span class="item__text">2018-10-09</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/MySql/">MySql</a></li><li class="tag-item"><a class="tag-link" href="/tags/图片/">图片</a></li><li class="tag-item"><a class="tag-link" href="/tags/定时器/">定时器</a></li><li class="tag-item"><a class="tag-link" href="/tags/组件化/">组件化</a></li><li class="tag-item"><a class="tag-link" href="/tags/自定义转场动画/">自定义转场动画</a></li><li class="tag-item"><a class="tag-link" href="/tags/锁/">锁</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>ShenZhen, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>anrugood@outlook.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/img/blogEwm.png" alt="logo" title="Anrue"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://southpeak.github.io/" title="南峰子" target="_blank">南峰子的技术博客</a></li><li class="list-item"><a href="https://www.kwen.work/" title="Kevin" target="_blank">Kevin‘s blod</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li><li class="list-item"><a href="https://developer.apple.com/xcode/" title="iOS" target="_blank">Xcode</a></li><li class="list-item"><a href="https://www.python.org/" title="Python 官网" target="_blank">Python</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Anrue" target="_blank">Anrue</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/anru1314" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:anrugood@outlook.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["MySql"],gitalk=new Gitalk({clientID:"59f35a92c3aaa2497cde",clientSecret:"602060680fba1dd4c13b187f933b3c715f88001c",repo:"xiaojiejie",owner:"anru1314",admin:["anru1314"],labels:tags,id:new Date(1539074031e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>